{"ast":null,"code":"var _jsxFileName = \"/Users/JV/react/front-end-playback/src/components/chart.jsx\";\nimport React from \"react\";\nimport { Dropdown, Table, Form, Button, Spinner, Row, Col, Alert } from \"react-bootstrap\";\nimport style from \"./chart.css\";\nimport { Line } from \"react-chartjs-2\";\nimport Routes from \"./routes\";\nconst lineColors = [\"rgb(237, 41, 58)\", \"rgb(75,192,192)\", \"rgb(230,54,192)\", \"rgb(100, 53, 201)\", \"rgb(33, 133, 208)\"];\nconst options = {\n  responsive: true,\n  scales: {\n    xAxes: [{\n      display: true,\n      scaleLabel: {\n        display: true,\n        labelString: \"Dates\"\n      }\n    }],\n    yAxes: [{\n      display: true,\n      scaleLabel: {\n        display: true,\n        labelString: \"# of Requests\"\n      }\n    }]\n  }\n};\n\nclass StatsChart extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleUpdate = result => {\n      if (!result) return null;\n      let i = 0; // update data to the line chart\n\n      let lineData = {};\n      lineData.datasets = [];\n      lineData.labels = result.labels;\n      result.data.forEach(uri => {\n        lineData.datasets.push({\n          label: `uri(${uri.name})`,\n          data: uri.traffic,\n          fill: false,\n          lineTension: 0.1,\n          backgroundColor: lineColors[i],\n          borderColor: lineColors[i],\n          borderCapStyle: \"butt\",\n          borderDash: [],\n          borderDashOffset: 0.0,\n          borderJoinStyle: \"miter\",\n          pointBorderColor: lineColors[i],\n          pointBackgroundColor: \"#fff\",\n          pointBorderWidth: 1,\n          pointHoverRadius: 5,\n          pointHoverBackgroundColor: lineColors[i],\n          pointHoverBorderColor: \"rgba(220,220,220,1)\",\n          pointHoverBorderWidth: 2,\n          pointRadius: 1,\n          pointHitRadius: 10\n        });\n        ++i;\n      });\n      this.setState({\n        lineData: lineData\n      });\n    };\n\n    this.state = {\n      lineData: {}\n    };\n  } // handle new request and update the line chart, result param received from StatsChartOptionsBar.\n\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: style.chartContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      className: style.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }\n    }, \"Traffic Analysis Chart\"), /*#__PURE__*/React.createElement(StatsChartOptionsBar, {\n      data: this.props.data,\n      lineHandler: this.handleUpdate,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"hr\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Line, {\n      data: this.state.lineData,\n      options: options,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\n\nclass StatsChartOptionsBar extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleFilter = event => {\n      let value = event.target.value.toLowerCase();\n      let visible = this.state.uriListVisible;\n\n      for (let i = 0; i < this.state.uriList.length; ++i) {\n        if (this.state.uriList[i].toLowerCase().indexOf(value) > -1) {\n          visible[i] = true;\n        } else {\n          visible[i] = false;\n        }\n      }\n\n      this.setState({\n        uriListVisible: visible\n      });\n    };\n\n    this.setDate = e => {\n      if (e.target.id === \"start-date\") {\n        this.startDate = e.target.value;\n      } else {\n        this.endDate = e.target.value;\n      }\n    };\n\n    this.handleApply = () => {\n      console.log(this.selectedUri);\n      console.log(this.startDate);\n      console.log(this.endDate);\n\n      if (this.endDate === \"\" || this.startDate === \"\" || this.selectedUri.length === 0) {\n        this.setState({\n          error: true,\n          errorText: \"Some information is empty.\"\n        });\n        return null;\n      }\n\n      if (this.endDate < this.startDate) {\n        this.setState({\n          error: true,\n          errorText: \"Error! End date is greater than start date!\"\n        });\n        return null;\n      }\n\n      this.setState({\n        applyLoading: true\n      });\n      setTimeout(() => {\n        if (this.props.data) {\n          let result = getDataFromTimeRange(this.startDate, this.endDate, this.selectedUri, this.props.data);\n          this.props.lineHandler(result);\n          this.setState({\n            error: false\n          });\n        } else {\n          this.setState({\n            error: true,\n            errorText: \"Internal Error! Database Not Connected!\"\n          });\n        }\n\n        this.setState({\n          applyLoading: false\n        });\n      }, 600);\n    };\n\n    this.handleAlert = () => {\n      this.setState({\n        error: false\n      });\n    };\n\n    this.state = {\n      uriList: [\"/home\", \"/home/uri\", \"/traffic/abc/dsassfcsaaaaaaaaa\", \"/hello\", \"/hi\", \"/abc\"],\n      uriListVisible: [true, true, true, true, true, true],\n      applyLoading: false,\n      error: false,\n      errorText: \"Something wrong!\"\n    };\n  } // handle uri filter in the uri dropdown.\n\n\n  render() {\n    const content = [];\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: style.optionContainer,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 12\n      }\n    });\n  }\n\n} // get a list of different uris from data that fetched from the database.\n\n\nfunction getUriList(data) {\n  let uriList = [];\n\n  if (data) {\n    data.forEach(row => {\n      let uri = row.uri; // uriList acts as set.\n\n      if (uriList.indexOf(uri) === -1) {\n        uriList.push(uri);\n      }\n    });\n  }\n\n  return uriList;\n} // summarize all uris with the total number of requests received so far.\n\n\nfunction getSummarizedData(data) {\n  let resultArray = null;\n\n  if (data) {\n    let result = {};\n    data.forEach(row => {\n      let uri = row.uri;\n\n      if (result[uri]) {\n        result[uri] += 1;\n      } else {\n        result[uri] = 1;\n      }\n    });\n    resultArray = [];\n    Object.keys(result).forEach(uri => {\n      resultArray.push({\n        uri: uri,\n        total: result[uri]\n      });\n    });\n    resultArray.sort((a, b) => {\n      if (a.total < b.total) return 1;\n      if (a.total > b.total) return -1;\n      return 0;\n    });\n    return resultArray;\n  }\n\n  return null;\n} // get total request number on each day for each requested uri from the given time range.\n\n\nfunction getDataFromTimeRange(start, end, requestedUri, data) {\n  if (!data) {\n    return null;\n  }\n\n  let startDateStr = start.toString().split(\"-\").join(\".\");\n  let startDate = new Date(startDateStr);\n  let unixStart = startDate.getTime();\n  let endDateStr = end.toString().split(\"-\").join(\".\");\n  let endDate = new Date(endDateStr);\n  endDate.setDate(endDate.getDate() + 1);\n  let unixEnd = endDate.getTime();\n  let numDays = 0;\n  let result = {};\n  result.data = [];\n  result.labels = [];\n  result.unixTimeLabels = [];\n  let current = new Date(startDateStr);\n\n  while (current <= endDate) {\n    ++numDays;\n    let label = `${current.getMonth() + 1}-${current.getDate()}`;\n    result.labels.push(label);\n    result.unixTimeLabels.push(current.getTime());\n    current.setDate(current.getDate() + 1);\n  }\n\n  numDays -= 1; // console.log('num day == ' + numDays);\n\n  let zeros = [];\n\n  for (let i = 0; i < numDays; ++i) zeros.push(0);\n\n  requestedUri.forEach(uri => {\n    result.data.push({\n      name: uri,\n      traffic: [...zeros]\n    });\n  });\n  let unixTimeRange = result.unixTimeLabels;\n\n  for (let i = 0; i < data.length; ++i) {\n    let unixTime = data[i].utime * 1000;\n\n    if (unixTime < unixStart || unixTime >= unixEnd) {\n      // out of range, skip to next data row.\n      continue;\n    }\n\n    let uri = data[i].uri; // console.log('on i = ' +  i + '  ' + uri);\n\n    for (let j = 0; j < numDays; ++j) {\n      let current = unixTimeRange[j];\n      let next = unixTimeRange[j + 1]; // console.log(`${current} ${unixTime} ${next}`);\n\n      if (unixTime >= current && unixTime < next) {\n        // console.log('match time');\n        for (let k = 0; k < requestedUri.length; ++k) {\n          if (uri === requestedUri[k]) {\n            result.data[k].traffic[j] += 1;\n            break;\n          }\n        }\n\n        break;\n      }\n    }\n  }\n\n  result.labels.pop();\n  result.unixTimeLabels.pop();\n  console.log(result);\n  return result;\n}\n\nexport default StatsChart;","map":{"version":3,"sources":["/Users/JV/react/front-end-playback/src/components/chart.jsx"],"names":["React","Dropdown","Table","Form","Button","Spinner","Row","Col","Alert","style","Line","Routes","lineColors","options","responsive","scales","xAxes","display","scaleLabel","labelString","yAxes","StatsChart","Component","constructor","props","handleUpdate","result","i","lineData","datasets","labels","data","forEach","uri","push","label","name","traffic","fill","lineTension","backgroundColor","borderColor","borderCapStyle","borderDash","borderDashOffset","borderJoinStyle","pointBorderColor","pointBackgroundColor","pointBorderWidth","pointHoverRadius","pointHoverBackgroundColor","pointHoverBorderColor","pointHoverBorderWidth","pointRadius","pointHitRadius","setState","state","render","chartContainer","title","StatsChartOptionsBar","handleFilter","event","value","target","toLowerCase","visible","uriListVisible","uriList","length","indexOf","setDate","e","id","startDate","endDate","handleApply","console","log","selectedUri","error","errorText","applyLoading","setTimeout","getDataFromTimeRange","lineHandler","handleAlert","content","optionContainer","getUriList","row","getSummarizedData","resultArray","Object","keys","total","sort","a","b","start","end","requestedUri","startDateStr","toString","split","join","Date","unixStart","getTime","endDateStr","getDate","unixEnd","numDays","unixTimeLabels","current","getMonth","zeros","unixTimeRange","unixTime","utime","j","next","k","pop"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  Dropdown,\n  Table,\n  Form,\n  Button,\n  Spinner,\n  Row,\n  Col,\n  Alert,\n} from \"react-bootstrap\";\nimport style from \"./chart.css\";\nimport { Line } from \"react-chartjs-2\";\nimport Routes from \"./routes\";\n\nconst lineColors = [\n  \"rgb(237, 41, 58)\",\n  \"rgb(75,192,192)\",\n  \"rgb(230,54,192)\",\n  \"rgb(100, 53, 201)\",\n  \"rgb(33, 133, 208)\",\n];\n\nconst options = {\n  responsive: true,\n  scales: {\n    xAxes: [\n      {\n        display: true,\n        scaleLabel: {\n          display: true,\n          labelString: \"Dates\",\n        },\n      },\n    ],\n    yAxes: [\n      {\n        display: true,\n        scaleLabel: {\n          display: true,\n          labelString: \"# of Requests\",\n        },\n      },\n    ],\n  },\n};\n\nclass StatsChart extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      lineData: {},\n    };\n  }\n\n  // handle new request and update the line chart, result param received from StatsChartOptionsBar.\n  handleUpdate = (result) => {\n    if (!result) return null;\n    let i = 0;\n    // update data to the line chart\n    let lineData = {};\n    lineData.datasets = [];\n    lineData.labels = result.labels;\n    result.data.forEach((uri) => {\n      lineData.datasets.push({\n        label: `uri(${uri.name})`,\n        data: uri.traffic,\n        fill: false,\n        lineTension: 0.1,\n        backgroundColor: lineColors[i],\n        borderColor: lineColors[i],\n        borderCapStyle: \"butt\",\n        borderDash: [],\n        borderDashOffset: 0.0,\n        borderJoinStyle: \"miter\",\n        pointBorderColor: lineColors[i],\n        pointBackgroundColor: \"#fff\",\n        pointBorderWidth: 1,\n        pointHoverRadius: 5,\n        pointHoverBackgroundColor: lineColors[i],\n        pointHoverBorderColor: \"rgba(220,220,220,1)\",\n        pointHoverBorderWidth: 2,\n        pointRadius: 1,\n        pointHitRadius: 10,\n      });\n      ++i;\n    });\n    this.setState({ lineData: lineData });\n  };\n\n  render() {\n    return (\n      <div className={style.chartContainer}>\n        <h2 className={style.title}>Traffic Analysis Chart</h2>\n        <StatsChartOptionsBar\n          data={this.props.data}\n          lineHandler={this.handleUpdate}\n        />\n        <hr></hr>\n        <Line data={this.state.lineData} options={options} />\n      </div>\n    );\n  }\n}\n\nclass StatsChartOptionsBar extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      uriList: [\n        \"/home\",\n        \"/home/uri\",\n        \"/traffic/abc/dsassfcsaaaaaaaaa\",\n        \"/hello\",\n        \"/hi\",\n        \"/abc\",\n      ],\n      uriListVisible: [true, true, true, true, true, true],\n      applyLoading: false,\n      error: false,\n      errorText: \"Something wrong!\",\n    };\n  }\n\n  // handle uri filter in the uri dropdown.\n  handleFilter = (event) => {\n    let value = event.target.value.toLowerCase();\n    let visible = this.state.uriListVisible;\n    for (let i = 0; i < this.state.uriList.length; ++i) {\n      if (this.state.uriList[i].toLowerCase().indexOf(value) > -1) {\n        visible[i] = true;\n      } else {\n        visible[i] = false;\n      }\n    }\n    this.setState({ uriListVisible: visible });\n  };\n\n  // set date onchange\n  setDate = (e) => {\n    if (e.target.id === \"start-date\") {\n      this.startDate = e.target.value;\n    } else {\n      this.endDate = e.target.value;\n    }\n  };\n\n  // apply and process custom filters and send result to the line chart.\n  handleApply = () => {\n    console.log(this.selectedUri);\n    console.log(this.startDate);\n    console.log(this.endDate);\n    if (\n      this.endDate === \"\" ||\n      this.startDate === \"\" ||\n      this.selectedUri.length === 0\n    ) {\n      this.setState({\n        error: true,\n        errorText: \"Some information is empty.\",\n      });\n      return null;\n    }\n    if (this.endDate < this.startDate) {\n      this.setState({\n        error: true,\n        errorText: \"Error! End date is greater than start date!\",\n      });\n      return null;\n    }\n    this.setState({ applyLoading: true });\n    setTimeout(() => {\n      if (this.props.data) {\n        let result = getDataFromTimeRange(\n          this.startDate,\n          this.endDate,\n          this.selectedUri,\n          this.props.data\n        );\n        this.props.lineHandler(result);\n        this.setState({ error: false });\n      } else {\n        this.setState({\n          error: true,\n          errorText: \"Internal Error! Database Not Connected!\",\n        });\n      }\n      this.setState({ applyLoading: false });\n    }, 600);\n  };\n\n  handleAlert = () => {\n    this.setState({ error: false });\n  };\n\n  render() {\n    const content = [];\n\n    return <div className={style.optionContainer}></div>;\n  }\n}\n\n// get a list of different uris from data that fetched from the database.\nfunction getUriList(data) {\n  let uriList = [];\n  if (data) {\n    data.forEach((row) => {\n      let uri = row.uri;\n      // uriList acts as set.\n      if (uriList.indexOf(uri) === -1) {\n        uriList.push(uri);\n      }\n    });\n  }\n  return uriList;\n}\n\n// summarize all uris with the total number of requests received so far.\nfunction getSummarizedData(data) {\n  let resultArray = null;\n  if (data) {\n    let result = {};\n    data.forEach((row) => {\n      let uri = row.uri;\n      if (result[uri]) {\n        result[uri] += 1;\n      } else {\n        result[uri] = 1;\n      }\n    });\n    resultArray = [];\n    Object.keys(result).forEach((uri) => {\n      resultArray.push({\n        uri: uri,\n        total: result[uri],\n      });\n    });\n    resultArray.sort((a, b) => {\n      if (a.total < b.total) return 1;\n      if (a.total > b.total) return -1;\n      return 0;\n    });\n    return resultArray;\n  }\n  return null;\n}\n\n// get total request number on each day for each requested uri from the given time range.\nfunction getDataFromTimeRange(start, end, requestedUri, data) {\n  if (!data) {\n    return null;\n  }\n  let startDateStr = start.toString().split(\"-\").join(\".\");\n  let startDate = new Date(startDateStr);\n  let unixStart = startDate.getTime();\n  let endDateStr = end.toString().split(\"-\").join(\".\");\n  let endDate = new Date(endDateStr);\n  endDate.setDate(endDate.getDate() + 1);\n  let unixEnd = endDate.getTime();\n  let numDays = 0;\n\n  let result = {};\n  result.data = [];\n  result.labels = [];\n  result.unixTimeLabels = [];\n\n  let current = new Date(startDateStr);\n  while (current <= endDate) {\n    ++numDays;\n    let label = `${current.getMonth() + 1}-${current.getDate()}`;\n    result.labels.push(label);\n    result.unixTimeLabels.push(current.getTime());\n    current.setDate(current.getDate() + 1);\n  }\n  numDays -= 1;\n  // console.log('num day == ' + numDays);\n\n  let zeros = [];\n  for (let i = 0; i < numDays; ++i) zeros.push(0);\n\n  requestedUri.forEach((uri) => {\n    result.data.push({\n      name: uri,\n      traffic: [...zeros],\n    });\n  });\n\n  let unixTimeRange = result.unixTimeLabels;\n\n  for (let i = 0; i < data.length; ++i) {\n    let unixTime = data[i].utime * 1000;\n    if (unixTime < unixStart || unixTime >= unixEnd) {\n      // out of range, skip to next data row.\n      continue;\n    }\n\n    let uri = data[i].uri;\n    // console.log('on i = ' +  i + '  ' + uri);\n    for (let j = 0; j < numDays; ++j) {\n      let current = unixTimeRange[j];\n      let next = unixTimeRange[j + 1];\n      // console.log(`${current} ${unixTime} ${next}`);\n      if (unixTime >= current && unixTime < next) {\n        // console.log('match time');\n        for (let k = 0; k < requestedUri.length; ++k) {\n          if (uri === requestedUri[k]) {\n            result.data[k].traffic[j] += 1;\n            break;\n          }\n        }\n        break;\n      }\n    }\n  }\n  result.labels.pop();\n  result.unixTimeLabels.pop();\n  console.log(result);\n  return result;\n}\n\nexport default StatsChart;\n"]},"metadata":{},"sourceType":"module"}